<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cz.zcu.kiv.crce.metadata.dao.internal.mapper.MetadataMapper">

    <resultMap  id="resourcemap" type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbResource">
        <id column="id" property="id" />
    </resultMap>
    <select id="getResource" parameterType="int" resultMap="resourcemap">
        select id
        from resource
        where internal_id = #{id}
    </select>

    <select id="getResources" resultMap="resourcemap">
        select *
        from resource
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbResource" id="resourcemap2">
        <id property="internal_id" column="internal_id" />
    </resultMap>
    <select id="getResourceID" parameterType="String" resultMap="resourcemap2">
        select internal_id
        from resource
        where id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbCapability" id="resourcemap3">
        <id column="internal_id" property="internal_id"/>
    </resultMap>
    <select id="getCapabilityID" parameterType="String" resultMap="resourcemap3">
        select internal_id
        from capability
        where id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbRequirement" id="resourcemap4">
        <id column="internal_id" property="internal_id"/>
    </resultMap>
    <select id="getRequirementID" parameterType="String" resultMap="resourcemap4">
        select internal_id
        from requirement
        where id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbCapability" id="resourcemap1">
        <id column="internal_id" property="internal_id"/>
        <id column="id" property="id"/>
        <id column="namespace" property="namespace"/>
        <id column="capability_id" property="capability_id"/>
    </resultMap>
    <select id="getCapability" parameterType="int" resultMap="resourcemap1">
        select internal_id, id, namespace, capability_id
        from capability
        where resource_id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbDirective" id="resourcemap5">
        <id column="internal_id" property="internal_id"/>
        <id column="name" property="name"/>
        <id column="value" property="value"/>
    </resultMap>
    <select id="getCapabilityDirective" parameterType="int" resultMap="resourcemap5">
        select internal_id, name, value
        from cap_directive
        where capability_id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbAttribute" id="resourcemap6">
<!--        <id column="internal_id" property="internal_id"/>
        <id column="type" property="type"/>
        <id column="name" property="name"/>
        <id column="value" property="value"/>
        <id column="operator" property="operator"/>-->
    </resultMap>
    <select id="getCapabilityAttribute" parameterType="int" resultMap="resourcemap6">
        select internal_id, type, name, value, operator
        from cap_attribute
        where capability_id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbRequirement" id="resourcemap7">
        <id column="internal_id" property="internal_id"/>
        <id column="id" property="id"/>
        <id column="namespace" property="namespace"/>
        <id column="requirement_id" property="requirement_id"/>
    </resultMap>
    <select id="getRequirement" parameterType="int" resultMap="resourcemap7">
        select internal_id, id, namespace, requirement_id
        from requirement
        where resource_id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbDirective" id="resourcemap8">
        <id column="internal_id" property="internal_id"/>
        <id column="name" property="name"/>
        <id column="value" property="value"/>
    </resultMap>
    <select id="getRequirementDirective" parameterType="int" resultMap="resourcemap8">
        select internal_id, name, value
        from req_directive
        where requirement_id = #{id}
    </select>

    <resultMap type="cz.zcu.kiv.crce.metadata.dao.internal.db.DbAttribute" id="resourcemap9">
        <id column="internal_id" property="internal_id"/>
        <id column="type" property="type"/>
        <id column="name" property="name"/>
        <id column="value" property="value"/>
        <id column="operator" property="operator"/>
    </resultMap>
    <select id="getRequirementAttribute" parameterType="int" resultMap="resourcemap9">
        select internal_id, type, name, value, operator
        from req_attribute
        where requirement_id = #{id}
    </select>

    <delete id="deleteResource" parameterType="int">
        DELETE FROM RESOURCE WHERE INTERNAL_ID = #{id}
    </delete>

    <!-- Inserts -->

    <insert id="insertResource" parameterType="cz.zcu.kiv.crce.metadata.dao.internal.db.DbResource">
        insert into resource (resource_id, id, uri) values (
          #{resourceId}, #{id}, #{uri}
        )
    </insert>

    <insert id="insertCapability" parameterType="cz.zcu.kiv.crce.metadata.dao.internal.db.DbCapability">
        insert into capability (capability_id, parent_capability_id, resource_id, id, namespace) values (
          #{capabilityId}, #{parentCapabilityId}, #{resourceId}, #{id}, #{namespace}
        )
    </insert>

    <insert id="insertRequirement" parameterType="cz.zcu.kiv.crce.metadata.dao.internal.db.DbRequirement">
        insert into requirement (requirement_id, parent_requirement_id, resource_id, id, namespace) values (
          #{requirementId}, #{parentRequirementId}, #{resourceId}, #{id}, #{namespace}
        )
    </insert>

    <insert id="insertCapabilityAttributes" parameterType="java.util.List">
        INSERT INTO capability_attribute (
          capability_id, name, list_index, type, operator, string_value, long_value, double_value,
          version_major_value, version_minor_value, version_micro_value
        ) VALUES
        <foreach collection="list" item="item" index="index" open="(" close=")" separator="), (">
            #{item.entityId, jdbcType=BIGINT},
            #{item.name, jdbcType=VARCHAR},
            #{item.listIndex, jdbcType=SMALLINT},
            #{item.type, jdbcType=SMALLINT},
            #{item.operator, jdbcType=SMALLINT},
            #{item.stringValue, jdbcType=VARCHAR},
            #{item.longValue, jdbcType=BIGINT},
            #{item.doubleValue, jdbcType=DOUBLE},
            #{item.versionMajorValue, jdbcType=INTEGER},
            #{item.versionMinorValue, jdbcType=INTEGER},
            #{item.versionMicroValue, jdbcType=INTEGER}
        </foreach>
    </insert>

    <insert id="insertRequirementAttributes" parameterType="java.util.List">
        INSERT INTO requirement_attribute (
          requirement_id, name, attribute_index, list_index, type, operator, string_value, long_value, double_value,
          version_major_value, version_minor_value, version_micro_value
        ) VALUES
        <foreach collection="list" item="item" index="index" open="(" close=")" separator="), (">
            #{item.entityId, jdbcType=BIGINT},
            #{item.name, jdbcType=VARCHAR},
            #{item.attributeIndex, jdbcType=SMALLINT},
            #{item.listIndex, jdbcType=SMALLINT},
            #{item.type, jdbcType=SMALLINT},
            #{item.operator, jdbcType=SMALLINT},
            #{item.stringValue, jdbcType=VARCHAR},
            #{item.longValue, jdbcType=BIGINT},
            #{item.doubleValue, jdbcType=DOUBLE},
            #{item.versionMajorValue, jdbcType=INTEGER},
            #{item.versionMinorValue, jdbcType=INTEGER},
            #{item.versionMicroValue, jdbcType=INTEGER}
        </foreach>
    </insert>

    <insert id="insertCapabilityDirectives" parameterType="java.util.List">
        INSERT INTO capability_directive (capability_id, name, value) VALUES
        <foreach collection="list" item="item" index="index" open="(" close=")" separator="), (">
            #{item.entityId, jdbcType=BIGINT},
            #{item.name, jdbcType=VARCHAR},
            #{item.value, jdbcType=VARCHAR},
        </foreach>
    </insert>

    <insert id="insertRequirementDirectives" parameterType="java.util.List">
        INSERT INTO requirement_directive (requirement_id, name, value) VALUES
        <foreach collection="list" item="item" index="index" open="(" close=")" separator="), (">
            #{item.entityId, jdbcType=BIGINT},
            #{item.name, jdbcType=VARCHAR},
            #{item.value, jdbcType=VARCHAR},
        </foreach>
    </insert>

</mapper>